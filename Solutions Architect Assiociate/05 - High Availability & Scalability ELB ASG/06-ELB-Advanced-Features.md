---
title: ELB Advanced Features
date: 2026-02-10
tags:
  - aws
  - elb
  - sticky-sessions
  - cross-zone
  - ssl
  - tls
  - sni
  - connection-draining
  - deregistration-delay
  - saa-c03
---

# ELB Advanced Features

This note covers four critical ELB features that come up frequently on the SAA-C03 exam: ==Sticky Sessions==, ==Cross-Zone Load Balancing==, ==SSL/TLS Certificates with SNI==, and ==Connection Draining / Deregistration Delay==. Each one changes how the load balancer routes, secures, or gracefully handles traffic â€” and understanding the nuances (especially the defaults per LB type) is essential.

---

## 1. Sticky Sessions (Session Affinity)

### What Is It?

Normally, a load balancer distributes requests across all healthy backend instances in a round-robin fashion. With ==sticky sessions== enabled, a client that makes a first request to the load balancer is "stuck" to the ==same backend instance== for all subsequent requests â€” as long as the stickiness cookie hasn't expired.

```
WITHOUT Sticky Sessions:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     Request 1 â”€â”€â–¶ EC2-A
â”‚ Client â”‚â”€â”€â”€â”€â–¶â”‚   ALB   â”‚     Request 2 â”€â”€â–¶ EC2-B   (round-robin)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     Request 3 â”€â”€â–¶ EC2-C

WITH Sticky Sessions:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     Request 1 â”€â”€â–¶ EC2-A
â”‚ Client â”‚â”€â”€â”€â”€â–¶â”‚   ALB   â”‚     Request 2 â”€â”€â–¶ EC2-A   (same instance!)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     Request 3 â”€â”€â–¶ EC2-A
                    â”‚
                    â””â”€â”€ Cookie: AWSALB=<hash>; Expires=<tomorrow>
```

### How It Works â€” The Cookie Mechanism

The load balancer sends a ==cookie== to the client's browser as part of the HTTP response. On every subsequent request, the browser sends that cookie back, and the load balancer reads it to determine which backend instance to route to. When the cookie ==expires==, the client may be redirected to a different instance.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Client â”‚â”€â”€ GET /page â”€â”€â”€â”€â”€â”€â–¶â”‚   ALB   â”‚â”€â”€ Forward â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  EC2-A  â”‚
â”‚        â”‚                    â”‚         â”‚                    â”‚         â”‚
â”‚        â”‚â—€â”€â”€ 200 OK â”€â”€â”€â”€â”€â”€â”€â”€â”‚         â”‚â—€â”€â”€ Response â”€â”€â”€â”€â”€â”€â”€â”‚         â”‚
â”‚        â”‚    Set-Cookie:     â”‚         â”‚                    â”‚         â”‚
â”‚        â”‚    AWSALB=abc123   â”‚         â”‚                    â”‚         â”‚
â”‚        â”‚    Expires=1d      â”‚         â”‚                    â”‚         â”‚
â”‚        â”‚                    â”‚         â”‚                    â”‚         â”‚
â”‚        â”‚â”€â”€ GET /next â”€â”€â”€â”€â”€â”€â–¶â”‚         â”‚                    â”‚         â”‚
â”‚        â”‚   Cookie:          â”‚ Reads   â”‚                    â”‚         â”‚
â”‚        â”‚   AWSALB=abc123    â”‚ cookie  â”‚â”€â”€ Route to EC2-A â”€â–¶â”‚         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Supported Load Balancers

| Load Balancer | Sticky Sessions? | Notes |
|---------------|-----------------|-------|
| **CLB** | âœ… Yes | Duration-based only |
| **ALB** | âœ… Yes | Duration-based + Application-based |
| **NLB** | âœ… Yes | Uses source IP hash (no cookie) |

### Cookie Types â€” Deep Dive

There are ==two categories== of stickiness cookies, and within application-based, there are two sub-types:

| Category | Sub-Type | Generated By | Cookie Name | Expiry Set By |
|----------|----------|-------------|-------------|---------------|
| **Duration-based** | â€” | ==Load balancer== | `AWSALB` (ALB), `AWSELB` (CLB) | ==Load balancer== (you set duration) |
| **Application-based** | LB-generated | ==Load balancer== | `AWSALBAPP` | ==Application== |
| **Application-based** | Custom | ==Your application== | Custom name (you choose) | ==Application== |

> [!warning] Reserved Cookie Names
> You ==must not== use the following names for custom cookies â€” they are reserved by ELB:
> - `AWSALB`
> - `AWSALBAPP`
> - `AWSALBTG`

### Configuration

| Setting | Details |
|---------|---------|
| **Where to configure** | ==Target Group level== â†’ Actions â†’ Edit attributes â†’ Stickiness |
| **Stickiness duration** | ==1 second to 7 days== |
| **Types available** | Load balancer generated cookie OR Application-based cookie |
| **App cookie name** | Required if using application-based (e.g., `MYCUSTOMCOOKIEAPP`) |

### The Risk: Load Imbalance

> [!danger] Exam Trap
> Sticky sessions can cause ==load imbalance==. If one user generates heavy traffic and is "stuck" to a single instance, that instance gets overloaded while others sit idle. This is the primary trade-off.

```
Imbalanced Scenario:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ALB    â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚
     â”œâ”€â”€â–¶ EC2-A â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ (80% load â€” sticky heavy user)
     â”œâ”€â”€â–¶ EC2-B â–ˆâ–ˆ               (10% load)
     â””â”€â”€â–¶ EC2-C â–ˆâ–ˆ               (10% load)
```

### When to Use Sticky Sessions

- âœ… Application stores session data ==locally on the instance== (login state, shopping cart)
- âœ… Legacy applications that can't use external session stores
- âŒ Better alternative: store sessions in ==ElastiCache or DynamoDB== and make the app stateless

### Hands-On Walkthrough

1. Open your ==ALB== in the EC2 console
2. Go to ==Target Groups== â†’ select your target group
3. Click ==Actions â†’ Edit attributes==
4. Scroll to ==Target selection configuration â†’ Stickiness==
5. Turn stickiness ==On==
6. Choose type:
   - **Load balancer generated cookie** â€” set duration (e.g., 1 day)
   - **Application-based cookie** â€” enter your custom cookie name
7. Click ==Save changes==
8. Open your ALB DNS in a browser â†’ refresh multiple times â†’ you'll always hit the ==same instance==
9. Open ==Developer Tools â†’ Network tab â†’ Cookies== to see the `AWSALB` cookie with its expiry

> [!tip] Verifying Stickiness
> Without stickiness: refreshing the page cycles through different instances (different AZ/instance IDs in the response). With stickiness: every refresh returns the ==same instance==. Check the `Set-Cookie` response header and the `Cookie` request header in your browser's dev tools.

---

## 2. Cross-Zone Load Balancing

### The Problem

When you create a load balancer across multiple AZs, each AZ gets its own ==load balancer node==. By default (for NLB/GWLB), each node only distributes traffic to instances ==within its own AZ==. If you have an uneven number of instances per AZ, this creates a ==severe imbalance==.

### With vs Without Cross-Zone Load Balancing

```
SCENARIO: 10 total instances â€” 2 in AZ1, 8 in AZ2
Client sends 50% to each AZ's LB node

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                WITH Cross-Zone Load Balancing                       â”‚
â”‚                                                                     â”‚
â”‚  AZ1 (LB Node)              AZ2 (LB Node)                         â”‚
â”‚  Receives 50%               Receives 50%                           â”‚
â”‚       â”‚                          â”‚                                  â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                  â”‚
â”‚                  â”‚                                                   â”‚
â”‚    Distributes evenly across ALL 10 instances                       â”‚
â”‚                                                                     â”‚
â”‚  AZ1: EC2-A (10%)  EC2-B (10%)                                     â”‚
â”‚  AZ2: EC2-C (10%)  EC2-D (10%)  EC2-E (10%)  EC2-F (10%)          â”‚
â”‚       EC2-G (10%)  EC2-H (10%)  EC2-I (10%)  EC2-J (10%)          â”‚
â”‚                                                                     â”‚
â”‚  Result: ==Every instance gets exactly 10%== âœ…                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              WITHOUT Cross-Zone Load Balancing                      â”‚
â”‚                                                                     â”‚
â”‚  AZ1 (LB Node)              AZ2 (LB Node)                         â”‚
â”‚  Receives 50%               Receives 50%                           â”‚
â”‚       â”‚                          â”‚                                  â”‚
â”‚       â–¼                          â–¼                                  â”‚
â”‚  Only sends to AZ1          Only sends to AZ2                      â”‚
â”‚  instances                  instances                               â”‚
â”‚                                                                     â”‚
â”‚  AZ1: EC2-A (==25%==)  EC2-B (==25%==)     â† OVERLOADED!          â”‚
â”‚  AZ2: EC2-C (6.25%) EC2-D (6.25%) EC2-E (6.25%) EC2-F (6.25%)    â”‚
â”‚       EC2-G (6.25%) EC2-H (6.25%) EC2-I (6.25%) EC2-J (6.25%)    â”‚
â”‚                                                                     â”‚
â”‚  Result: AZ1 instances get ==4x more traffic== than AZ2 âŒ         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Defaults & Charges â€” Critical for Exam

| Load Balancer | Cross-Zone Default | Inter-AZ Data Charges | Can Override? |
|---------------|-------------------|----------------------|---------------|
| **ALB** | ==Always ON== | ==No charge== | Yes â€” per target group (inherit / force on / ==force off==) |
| **NLB** | ==OFF== | ==Charged== if enabled | Yes â€” at LB attributes level |
| **GWLB** | ==OFF== | ==Charged== if enabled | Yes â€” at LB attributes level |
| **CLB** | ==OFF== | ==No charge== if enabled | Yes â€” at LB attributes level |

> [!important] Exam Must-Know
> - ALB: cross-zone is ==always on by default, no extra charges==
> - NLB/GWLB: cross-zone is ==off by default, you pay for inter-AZ data== if you enable it
> - ALB allows ==per-target-group override==: inherit (default), force on, or force off
> - CLB: off by default, but ==no charges== if you enable it (unlike NLB/GWLB)

### Why Inter-AZ Data Costs Matter

In AWS, data transfer ==between Availability Zones== normally costs money. When cross-zone load balancing is enabled, the LB node in AZ1 sends traffic to instances in AZ2 â€” that's inter-AZ data transfer. ALB absorbs this cost for you. NLB and GWLB pass it on.

### Hands-On Walkthrough

**NLB / GWLB:**
1. Go to ==EC2 Console â†’ Load Balancers== â†’ select your NLB or GWLB
2. Scroll down to ==Attributes== â†’ you'll see "Cross-zone load balancing: ==Off=="
3. Click ==Edit== â†’ toggle ==On==
4. Note the warning: =="This may include regional data transfer charges"==

**ALB:**
1. Select your ALB â†’ ==Attributes== â†’ "Cross-zone load balancing: ==On==" (always)
2. This cannot be turned off at the LB level
3. To override: go to ==Target Groups== â†’ select a target group â†’ ==Attributes â†’ Edit==
4. Under "Cross-zone load balancing": choose ==Inherit== (default), ==On==, or ==Off==

---

## 3. SSL/TLS Certificates

### What Is SSL/TLS?

==SSL (Secure Sockets Layer)== and ==TLS (Transport Layer Security)== are cryptographic protocols that encrypt traffic ==in transit== between the client and the load balancer. TLS is the newer, more secure version â€” but everyone (including AWS) still calls it "SSL" colloquially.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   HTTPS (encrypted)   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   HTTP (unencrypted)   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Client â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â–¶  â”‚   ELB   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚   EC2   â”‚
â”‚        â”‚   Public Internet     â”‚         â”‚   Private VPC Network   â”‚         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â”œâ”€â”€ Loads X.509 certificate
                                      â”œâ”€â”€ Performs SSL termination
                                      â””â”€â”€ Decrypts HTTPS â†’ forwards HTTP
```

> [!note] SSL Termination
> The load balancer ==decrypts the HTTPS traffic== (terminates the SSL connection) and forwards ==unencrypted HTTP== to the backend EC2 instances over the private VPC network. This offloads the CPU-intensive encryption work from your instances.

### Key Concepts

| Concept | Detail |
|---------|--------|
| **Certificate type** | ==X.509== (SSL/TLS server certificate) |
| **Management** | ==AWS Certificate Manager (ACM)== â€” provision, manage, deploy certs |
| **Upload own cert** | Yes â€” paste private key + certificate body + chain into ACM |
| **HTTPS listener** | Must specify a ==default certificate== |
| **Multiple domains** | Add optional list of certs to support multiple domains via ==SNI== |
| **Security policy** | Configurable â€” choose which SSL/TLS protocol versions to support (for legacy clients) |
| **Certificate Authorities** | Comodo, Symantec, GoDaddy, GlobalSign, DigiCert, Let's Encrypt, etc. |
| **Expiration** | SSL certs have an ==expiration date== and must be renewed regularly |

### The Lock Icon

When you visit a website and see a ==ğŸ”’ lock icon== in the browser address bar, that means the connection is encrypted with SSL/TLS. If you see a âš ï¸ warning instead, the traffic is ==not encrypted== â€” don't enter sensitive information.

### SNI (Server Name Indication) â€” Critical for Exam

#### The Problem SNI Solves

Imagine you have ==one ALB== serving two different websites: `www.mycorp.com` and `domain1.example.com`. Each website needs its ==own SSL certificate==. Without SNI, you'd need a separate load balancer for each domain. SNI solves this by letting the client tell the server ==which hostname it wants== during the initial SSL handshake.

#### How SNI Works

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SNI (Server Name Indication)                      â”‚
â”‚                                                                      â”‚
â”‚  Client 1                                                            â”‚
â”‚  "I want www.mycorp.com"                                             â”‚
â”‚       â”‚                                                              â”‚
â”‚       â”‚  TLS ClientHello:                                            â”‚
â”‚       â”‚  server_name = "www.mycorp.com"                              â”‚
â”‚       â–¼                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   Uses mycorp.com cert    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚         â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚  Target Group 1     â”‚     â”‚
â”‚  â”‚   ALB   â”‚                           â”‚  (www.mycorp.com)    â”‚     â”‚
â”‚  â”‚         â”‚                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚  â”‚  Certs: â”‚                                                        â”‚
â”‚  â”‚  â”œ mycorp.com                                                    â”‚
â”‚  â”‚  â”” domain1.example.com                                           â”‚
â”‚  â”‚         â”‚                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚         â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚  Target Group 2     â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   Uses domain1 cert       â”‚  (domain1.example)   â”‚     â”‚
â”‚       â–²                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚       â”‚                                                              â”‚
â”‚  Client 2                                                            â”‚
â”‚  "I want domain1.example.com"                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### SNI Support by Load Balancer Type

| Load Balancer | Multiple SSL Certs? | SNI Support? | What To Do Instead? |
|---------------|-------------------|-------------|-------------------|
| **CLB** | ==No== â€” only 1 cert | âŒ No SNI | Need ==multiple CLBs== (one per domain) |
| **ALB** | ==Yes== â€” multiple listeners | âœ… SNI | Use listener rules to route by hostname |
| **NLB** | ==Yes== â€” multiple listeners | âœ… SNI | Same as ALB |
| **CloudFront** | ==Yes== | âœ… SNI | Covered in CloudFront section |

> [!tip] Exam Keyword
> "Multiple SSL certificates on one load balancer" â†’ ==ALB or NLB with SNI==. If the question mentions CLB, the answer is "use multiple CLBs."

### Hands-On: Adding HTTPS Listener

**On ALB:**
1. Go to ==EC2 Console â†’ Load Balancers== â†’ select your ALB
2. Click ==Listeners â†’ Add listener==
3. Protocol: ==HTTPS==, Port: ==443==
4. Default action: ==Forward to== a target group
5. Under ==Secure listener settings==:
   - **Security policy**: Choose a policy (default is fine for most cases; older policies support legacy SSL/TLS versions)
   - **Default SSL/TLS certificate**: Choose from:
     - ==ACM== (AWS Certificate Manager) â€” recommended
     - ==IAM== â€” not recommended (legacy method)
     - ==Import== â€” paste private key + certificate body + chain
6. Click ==Add==

**On NLB:**
1. Same process, but protocol is ==TLS== (not HTTPS)
2. Additional option: ==ALPN (Application-Layer Protocol Negotiation)== â€” advanced TLS setting

> [!note] ACM Integration
> The easiest way is to provision a free public certificate in ==ACM== and select it when creating the HTTPS/TLS listener. ACM handles automatic renewal.

---

## 4. Connection Draining / Deregistration Delay

### What Is It?

When an instance is being ==deregistered== from a target group (e.g., scaling down, failing health checks, manual removal), there may be ==in-flight requests== still being processed by that instance. Connection draining gives those requests time to ==complete gracefully== before the instance is fully removed.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CONNECTION DRAINING IN ACTION                      â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                                                          â”‚
â”‚  â”‚User A  â”‚â”€â”€â”€â”€ Existing request â”€â”€â”€â”€â–¶ EC2-A (DRAINING)             â”‚
â”‚  â”‚(active)â”‚     Still processing...   â”‚ â³ Completing in-flight     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜     Connection allowed    â”‚    requests...              â”‚
â”‚                                       â”‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚                              â”‚
â”‚  â”‚User B  â”‚â”€â”€â”€â”€â–¶â”‚   ELB   â”‚â”€â”€âœ—â”€â”€â”€â”€â”€â”€â–¶â”‚ NEW connections BLOCKED     â”‚
â”‚  â”‚ (new)  â”‚     â”‚         â”‚          â”‚                              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚         â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚                 â”‚         â”‚                                          â”‚
â”‚                 â”‚         â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ EC2-B (HEALTHY) âœ…            â”‚
â”‚                 â”‚         â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ EC2-C (HEALTHY) âœ…            â”‚
â”‚                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                          â”‚
â”‚                                                                      â”‚
â”‚  After draining period expires:                                      â”‚
â”‚  EC2-A is fully deregistered, all connections closed                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Naming Convention

| Load Balancer | Feature Name |
|---------------|-------------|
| **CLB** | ==Connection Draining== |
| **ALB / NLB** | ==Deregistration Delay== |

Same concept, different names. The exam may use either term.

### Configuration Parameters

| Parameter | Value |
|-----------|-------|
| **Default** | ==300 seconds== (5 minutes) |
| **Range** | ==1 to 3,600 seconds== |
| **Disable** | Set to ==0== (no draining â€” connections cut immediately) |

### Choosing the Right Duration

The draining duration should match your application's request patterns:

```
Request Duration vs Draining Time:

Short requests (< 1 sec):     Draining = 30 seconds
â”œâ”€â”€ API calls, web pages
â”œâ”€â”€ Instance freed quickly
â””â”€â”€ Minimal impact on scaling speed

Medium requests (1-30 sec):   Draining = 60-120 seconds
â”œâ”€â”€ Form submissions, queries
â””â”€â”€ Balanced approach

Long requests (30+ sec):      Draining = 300-3600 seconds
â”œâ”€â”€ File uploads, video processing
â”œâ”€â”€ Instance stays longer
â””â”€â”€ Slower scaling response
```

> [!tip] Best Practice
> - ==Short-lived requests== (API calls, web pages): set draining to ==30 seconds== â€” instances are freed quickly for replacement
> - ==Long-lived requests== (file uploads, WebSocket connections): set draining to ==300+ seconds== â€” but the trade-off is slower instance turnover
> - ==Disable (0)== only if your application handles reconnection gracefully

### What Triggers Draining?

| Trigger | Description |
|---------|-------------|
| **Health check failure** | Instance marked unhealthy â†’ enters draining |
| **Manual deregistration** | You remove an instance from the target group |
| **ASG scale-in** | Auto Scaling terminates an instance |
| **ASG instance refresh** | Rolling replacement of instances |

### Lifecycle During Draining

```
Timeline:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ Time

â”‚ Instance healthy â”‚ Draining starts â”‚ Draining period â”‚ Terminated â”‚
â”‚   (serving all   â”‚ (trigger event) â”‚ (in-flight only)â”‚ (removed)  â”‚
â”‚    requests)     â”‚                 â”‚                 â”‚            â”‚
                   â”‚                 â”‚                 â”‚
                   â”‚  New requests   â”‚  Existing       â”‚
                   â”‚  â†’ other        â”‚  connections    â”‚
                   â”‚    instances    â”‚  complete or    â”‚
                   â”‚                 â”‚  timeout        â”‚
```

---

## Summary Comparison

| Feature | What It Does | Key Default | Exam Keyword |
|---------|-------------|-------------|-------------|
| **Sticky Sessions** | Routes client to ==same instance== via cookie | Off | "Session affinity", "AWSALB cookie" |
| **Cross-Zone LB** | Distributes traffic ==evenly across all AZs== | ALB: On (free), NLB/GWLB: Off (paid) | "Even distribution", "inter-AZ" |
| **SSL/TLS + SNI** | ==Multiple SSL certs== on one LB | â€” | "Multiple domains", "SNI", "ACM" |
| **Connection Draining** | ==Graceful shutdown== for in-flight requests | 300 seconds | "Deregistration delay", "in-flight" |

---

## Questions & Answers

> [!question]- Q1: What are sticky sessions and how do they work?
> **Answer:**
> Sticky sessions (session affinity) ensure a client is always routed to the ==same backend instance== using a ==cookie==. The load balancer sends a cookie (e.g., `AWSALB`) with an expiration date. On subsequent requests, the browser sends the cookie back, and the LB reads it to route to the same instance. When the cookie expires, the client may be redirected to a different instance. Supported on CLB, ALB, and NLB.

> [!question]- Q2: What are the two types of stickiness cookies and how do they differ?
> **Answer:**
> - **Duration-based cookies**: Generated by the ==load balancer==. Cookie name is `AWSALB` (ALB) or `AWSELB` (CLB). Expiry duration is set by you (1 second to 7 days) at the target group level.
> - **Application-based cookies**: Can be generated by the ==LB== (cookie name: `AWSALBAPP`) or by ==your application== (custom name). Expiry is controlled by the application. You must not use reserved names (`AWSALB`, `AWSALBAPP`, `AWSALBTG`).

> [!question]- Q3: What is the main risk of enabling sticky sessions?
> **Answer:**
> ==Load imbalance==. If a "sticky" user generates heavy traffic, their assigned instance gets overloaded while other instances sit idle. The better architectural pattern is to store session data externally (in ==ElastiCache or DynamoDB==) and make the application stateless.

> [!question]- Q4: What is cross-zone load balancing and why does it matter?
> **Answer:**
> Cross-zone load balancing distributes traffic ==evenly across all registered instances in all AZs==, regardless of which AZ the LB node received the request. Without it, traffic stays within each AZ â€” if you have 2 instances in AZ1 and 8 in AZ2, AZ1 instances get ==25% each== while AZ2 instances get only ==6.25% each==. With cross-zone enabled, all 10 instances get ==10% each==.

> [!question]- Q5: What are the cross-zone load balancing defaults for each LB type?
> **Answer:**
> | LB Type | Default | Inter-AZ Charges |
> |---------|---------|-----------------|
> | ALB | ==Always ON== | ==No charge== |
> | NLB | ==OFF== | ==Charged== if enabled |
> | GWLB | ==OFF== | ==Charged== if enabled |
> | CLB | ==OFF== | ==No charge== if enabled |
>
> ALB allows per-target-group override (inherit / force on / force off).

> [!question]- Q6: What is SNI and which load balancers support it?
> **Answer:**
> ==Server Name Indication (SNI)== allows loading ==multiple SSL certificates on one load balancer== for different domains. The client specifies the desired hostname during the TLS handshake (`ClientHello`), and the LB selects the correct certificate. Supported on ==ALB, NLB, and CloudFront==. ==CLB does NOT support SNI== â€” you need one CLB per SSL certificate.

> [!question]- Q7: How many SSL certificates can a CLB have vs an ALB?
> **Answer:**
> - **CLB**: ==Only one== SSL certificate. For multiple domains, you need ==multiple CLBs==.
> - **ALB/NLB**: ==Multiple== SSL certificates via multiple listeners using ==SNI==.
>
> This is why CLB is considered legacy â€” ALB/NLB are far more flexible.

> [!question]- Q8: What is connection draining and what is it called on ALB/NLB?
> **Answer:**
> Connection draining gives ==in-flight requests time to complete== when an instance is being deregistered or marked unhealthy. New requests are routed to other healthy instances. On CLB it's called ==Connection Draining==. On ALB/NLB it's called ==Deregistration Delay==. Default is ==300 seconds==, range is 1â€“3,600 seconds, and setting it to 0 disables it.

> [!question]- Q9: How should you set the connection draining duration?
> **Answer:**
> Match it to your request patterns:
> - ==Short requests== (API calls, web pages): set to ==30 seconds== â€” instances are freed quickly
> - ==Long requests== (file uploads, WebSocket): set to ==300+ seconds== â€” but slower instance turnover
> - ==Disable (0)==: only if your app handles reconnection gracefully
>
> The trade-off: longer draining = more graceful shutdown but slower scaling response.

> [!question]- Q10: Where are SSL/TLS certificates managed in AWS and what are the options?
> **Answer:**
> Certificates are managed in ==AWS Certificate Manager (ACM)==. When creating an HTTPS/TLS listener, you can:
> 1. Select a certificate from ==ACM== (recommended â€” free public certs with auto-renewal)
> 2. Select from ==IAM== (legacy method, not recommended)
> 3. ==Import== your own certificate (paste private key + body + chain)
>
> You must specify a ==default certificate== for the HTTPS listener, then optionally add more certs for SNI.
